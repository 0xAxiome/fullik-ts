(function(h,n){"object"===typeof exports&&"undefined"!==typeof module?n(exports):"function"===typeof define&&define.amd?define(["exports"],n):n(h.FIK={})})(this,function(h){function n(a,b){this.x=a||0;this.y=b||0}function m(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0}function y(){this.elements=[1,0,0,0,1,0,0,0,1];0<arguments.length&&console.error("M3: the constructor no longer reads arguments. use .set() instead.")}function v(){this.rotor=t;this.min=-t;this.max=t;this.freeHinge=!0;this.rotationAxisUV=
new m;this.referenceAxisUV=new m;this.type=10}function u(a,b,c,d,e){this.joint=new v;this.start=new m;this.end=new m;this.boneConnectionPoint=21;this.length=0;this.color=e||16777215;this.name="";this.init(a,b,c,d)}function z(a){this.tmpTarget=new m;this.tmpMtx=new y;this.bones=[];this.name="";this.color=a||16777215;this.solveDistanceThreshold=1;this.maxIteration=20;this.minIterationChange=.01;this.precision=.001;this.numBones=this.chainLength=0;this.baseLocation=new m;this.fixedBaseMode=!0;this.baseboneConstraintType=
1;this.baseboneConstraintUV=new m;this.baseboneRelativeConstraintUV=new m;this.baseboneRelativeReferenceConstraintUV=new m;this.lastTargetLocation=new m(Infinity,Infinity,Infinity);this.lastBaseLocation=new m(Infinity,Infinity,Infinity);this.currentSolveDistance=Infinity;this.connectedBoneNumber=this.connectedChainNumber=-1;this.boneConnectionPoint=21;this.isFullForward=!1;this.embeddedTarget=new m;this.useEmbeddedTarget=!1}function B(a){this.fixedBaseMode=!0;this.chains=[];this.meshChains=[];this.targets=
[];this.numChains=0;this.scene=a;this.tmpMtx=new FIK.M3;this.isWithMesh=!1}function w(a,b,c){this.coordinateSystem=c||11;this.min=void 0!==a?-a*q:-t;this.max=void 0!==b?b*q:t}function x(a,b,c,d,e,f,g){this.start=new n;this.end=new n;this.length=d||0;this.joint=new w(e,f);this.globalConstraintUV=new n(1,0);this.boneConnectionPoint=21;this.color=g||null;this.name="";this.setStartLocation(a);b?(this.setEndLocation(b),0===this.length&&(this.length=this.getLength())):c&&this.setEndLocation(this.start.plus(c.normalised().times(this.length)))}
function A(a){this.tmpTarget=new n;this.bones=[];this.name="";this.solveDistanceThreshold=1;this.minIterationChange=.01;this.maxIteration=15;this.precision=.001;this.numBones=this.chainLength=0;this.baseLocation=new n;this.fixedBaseMode=!0;this.baseboneConstraintType=1;this.baseboneConstraintUV=new n;this.baseboneRelativeConstraintUV=new n;this.lastTargetLocation=new n(Infinity,Infinity);this.lastBaseLocation=new n(Infinity,Infinity);this.boneConnectionPoint=21;this.currentSolveDistance=Infinity;
this.connectedBoneNumber=this.connectedChainNumber=-1;this.color=a||16777215;this.embeddedTarget=new n;this.useEmbeddedTarget=!1}function C(a){this.fixedBaseMode=!0;this.chains=[];this.meshChains=[];this.targets=[];this.numChains=0;this.scene=a;this.isWithMesh=!1}function D(){this.goal=this.target=this.endBones=this.startBones=null;this.swivelAngle=0;this.iteration=40;this.thresholds={position:.1,rotation:.1};this.chain=this.solver=null}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52));void 0===
Math.sign&&(Math.sign=function(a){return 0>a?-1:0<a?1:+a});void 0===Function.prototype.name&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}});void 0===Object.assign&&function(){Object.assign=function(a){if(void 0===a||null===a)throw new TypeError("Cannot convert undefined or null to object");for(var b=Object(a),c=1;c<arguments.length;c++){var d=arguments[c];if(void 0!==d&&null!==d)for(var e in d)Object.prototype.hasOwnProperty.call(d,
e)&&(b[e]=d[e])}return b}}();var r={error:function(a){console.error(a)}},p={toRad:Math.PI/180,toDeg:180/Math.PI,pi90:.5*Math.PI,clamp:function(a,b,c){a=a<b?b:a;return a>c?c:a},lerp:function(a,b,c){return(1-c)*a+c*b},rand:function(a,b){return a+Math.random()*(b-a)},randInt:function(a,b){return a+Math.floor(Math.random()*(b-a+1))},nearEquals:function(a,b,c){return Math.abs(a-b)<=c?!0:!1},radtodeg:function(a){return a*p.toDeg},degtorad:function(a){return a*p.toRad},cot:function(a){return 1/Math.tan(a)},
perpendicular:function(a,b){return p.nearEquals(a.dot(b),0,.01)?!0:!1},scalarProduct:function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z},genPerpendicularVectorQuick:function(a){var b=a.clone();return.99>Math.abs(a.y)?b.set(-a.z,0,a.x).normalize():b.set(0,a.z,-a.y).normalize()},genPerpendicularVectorFrisvad:function(a){var b=a.clone();if(-.9999999>a.z)return b.set(0,-1,0);var c=1/(1+a.z);return b.set(1-a.x*a.x*c,-a.x*a.y*c,-a.x).normalize()},rotateXDegs:function(a,b){return p.rotateXRads(a,b*p.toRad)},rotateYDegs:function(a,
b){return p.rotateYRads(a,b*p.toRad)},rotateZDegs:function(a,b){return p.rotateZRads(a,b*p.toRad)},rotateXRads:function(a,b){var c=Math.cos(b);b=Math.sin(b);return a.clone().set(a.x,a.y*c-a.z*b,a.y*b+a.z*c)},rotateYRads:function(a,b){var c=Math.cos(b);b=Math.sin(b);return a.clone().set(a.z*b+a.x*c,a.y,a.z*c-a.x*b)},rotateZRads:function(a,b){var c=Math.cos(b);b=Math.sin(b);return a.clone().set(a.x*c-a.y*b,a.x*b+a.y*c,a.z)},withinManhattanDistance:function(a,b,c){return Math.abs(b.x-a.x)>c||Math.abs(b.y-
a.y)>c||Math.abs(b.z-a.z)>c?!1:!0},manhattanDistanceBetween:function(a,b){return Math.abs(b.x-a.x)+Math.abs(b.x-a.x)+Math.abs(b.x-a.x)},distanceBetween:function(a,b){var c=b.x-a.x,d=b.y-a.y;a=void 0!==a.z?b.z-a.z:0;return Math.sqrt(c*c+d*d+a*a)},rotateRads:function(a,b){var c=Math.cos(b);b=Math.sin(b);return a.clone().set(a.x*c-a.y*b,a.x*b+a.y*c)},rotateDegs:function(a,b){return p.rotateRads(a,b*p.toRad)},validateDirectionUV:function(a){0>a.length()&&r.error("vector direction unit vector cannot be zero.")},
validateLength:function(a){0>a&&r.error("Length must be a greater than or equal to zero.")}};Object.assign(n.prototype,{isVector2:!0,set:function(a,b){this.x=a||0;this.y=b||0;return this},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x;a=this.y-a.y;return b*b+a*a},multiplyScalar:function(a){this.x*=a;this.y*=a;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},length:function(){return Math.sqrt(this.x*this.x+this.y*
this.y)},normalize:function(){return this.divideScalar(this.length()||1)},normalised:function(){return(new n(this.x,this.y)).normalize()},lengthSq:function(){return this.x*this.x+this.y*this.y},add:function(a){this.x+=a.x;this.y+=a.y;return this},plus:function(a){return new n(this.x+a.x,this.y+a.y)},min:function(a){this.x-=a.x;this.y-=a.y;return this},minus:function(a){return new n(this.x-a.x,this.y-a.y)},divideBy:function(a){return(new n(this.x,this.y)).divideScalar(a)},times:function(a){return a.isVector2?
new n(this.x*a.x,this.y*a.y):new n(this.x*a,this.y*a,this.z*a)},randomise:function(a,b){this.x=p.rand(a,b);this.y=p.rand(a,b);return this},dot:function(a,b){return this.x*a.x+this.y*a.y},negate:function(){this.x=-this.x;this.y=-this.y;return this},negated:function(){return new n(-this.x,-this.y)},clone:function(){return new n(this.x,this.y)},copy:function(a){this.x=a.x;this.y=a.y;return this},cross:function(a){return this.x*a.y-this.y*a.x},sign:function(a){return 0<=this.cross(a)?1:-1},approximatelyEquals:function(a,
b){if(0>b)return!1;var c=Math.abs(this.y-a.y);return Math.abs(this.x-a.x)<b&&c<b},rotate:function(a){var b=Math.cos(a);a=Math.sin(a);return new n(this.x*b-this.y*a,this.x*a+this.y*b)},rotateSelf:function(a){var b=Math.cos(a);a=Math.sin(a);var c=this.x*a+this.y*b;this.x=this.x*b-this.y*a;this.y=c;return this},angleTo:function(a){a=this.dot(a)/Math.sqrt(this.lengthSq()*a.lengthSq());return-1>=a?Math.PI:1<=a?0:Math.acos(a)},getSignedAngle:function(a){var b=this.angleTo(a);return 1===this.sign(a)?b:-b},
constrainedUV:function(a,b,c){var d=a.getSignedAngle(this);d>c&&this.copy(a.rotate(c));d<b&&this.copy(a.rotate(b));return this}});Object.assign(m.prototype,{isVector3:!0,set:function(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0;return this},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y;a=this.z-a.z;return b*b+c*c+a*a},abs:function(){return new m(0>this.x?-this.x:this.x,0>this.y?-this.y:this.y,0>this.z?-this.z:this.z)},
multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=a;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},divideScalar:function(a){return this.multiplyScalar(1/a)},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},normalize:function(){return this.divideScalar(this.length()||1)},normalised:function(){return(new m(this.x,this.y,this.z)).normalize()},add:function(a){this.x+=a.x;this.y+=
a.y;this.z+=a.z;return this},plus:function(a){return new m(this.x+a.x,this.y+a.y,this.z+a.z)},min:function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;return this},minus:function(a){return new m(this.x-a.x,this.y-a.y,this.z-a.z)},divideBy:function(a){return new m(this.x/a,this.y/a,this.z/a)},times:function(a){return a.isVector3?new m(this.x*a.x,this.y*a.y,this.z*a.z):new m(this.x*a,this.y*a,this.z*a)},randomise:function(a,b){this.x=p.rand(a,b);this.y=p.rand(a,b);this.z=p.rand(a,b);return this},cross:function(a){return new m(this.y*
a.z-this.z*a.y,this.z*a.x-this.x*a.z,this.x*a.y-this.y*a.x)},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},negated:function(){return new m(-this.x,-this.y,-this.z)},clone:function(){return new m(this.x,this.y,this.z)},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},approximatelyEquals:function(a,b){if(0>b)return!1;var c=Math.abs(this.y-a.y),d=Math.abs(this.z-a.z);return Math.abs(this.x-a.x)<b&&c<b&&d<b},zero:function(){this.z=this.y=this.x=0;return this},
projectOnVector:function(a){var b=a.dot(this)/a.lengthSq();return this.copy(a).multiplyScalar(b)},projectOnPlane:function(){var a=new m;return function(b){a.copy(this).projectOnVector(b.normalised());return this.min(a).normalize()}}(),applyM3:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[1]*c+a[2]*d;this.y=a[3]*b+a[4]*c+a[5]*d;this.z=a[6]*b+a[7]*c+a[8]*d;return this.normalize()},applyMatrix3:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[3]*c+a[6]*
d;this.y=a[1]*b+a[4]*c+a[7]*d;this.z=a[2]*b+a[5]*c+a[8]*d;return this},applyQuaternion:function(a){var b=this.x,c=this.y,d=this.z,e=a.x,f=a.y,g=a.z;a=a.w;var h=a*b+f*d-g*c,l=a*c+g*b-e*d,k=a*d+e*c-f*b;b=-e*b-f*c-g*d;this.x=h*a+b*-e+l*-g-k*-f;this.y=l*a+b*-f+k*-e-h*-g;this.z=k*a+b*-g+h*-f-l*-e;return this},sign:function(a,b){return 0<=this.cross(a).dot(b)?1:-1},angleTo:function(a){a=this.dot(a)/Math.sqrt(this.lengthSq()*a.lengthSq());return-1>=a?Math.PI:1<=a?0:Math.acos(a)},getSignedAngle:function(a,
b){var c=this.angleTo(a);return 1===this.sign(a,b)?c:-c},constrainedUV:function(a,b,c,d,e){var f=a.getSignedAngle(this,b);f>e&&this.copy(c.rotateAboutAxis(a,e,b));f<d&&this.copy(c.rotateAboutAxis(a,d,b));return this},limitAngle:function(a,b,c){if(a.angleTo(this)>c){var d=a.normalised().cross(this).normalize();this.copy(b.rotateAboutAxis(a,c,d))}return this}});Object.assign(y.prototype,{isMatrix3:!0,set:function(a,b,c,d,e,f,g,h,l){var k=this.elements;k[0]=a;k[1]=d;k[2]=g;k[3]=b;k[4]=e;k[5]=h;k[6]=
c;k[7]=f;k[8]=l;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},setV3:function(a,b,c){var d=this.elements;d[0]=a.x;d[3]=a.y;d[6]=a.z;d[1]=b.x;d[4]=b.y;d[7]=b.z;d[2]=c.x;d[5]=c.y;d[8]=c.z;return this},createRotationMatrix:function(a){var b=new m(1,0,0),c=new m(0,1,0);if(-.9999999>a.z)b.set(1,0,0),c.set(0,1,0);else{var d=1/(1+a.z),e=-a.x*a.y*d;b.set(1-a.x*a.x*d,e,-a.x).normalize();c.set(e,1-a.y*a.y*d,-a.y).normalize()}return this.setV3(b,c,a)},rotateAboutAxis:function(a,b,
c){var d=Math.sin(b);b=Math.cos(b);var e=1-b,f=c.x*c.y*e,g=c.x*c.z*e,h=c.y*c.z*e,l=this.elements;l[0]=c.x*c.x*e+b;l[3]=f+c.z*d;l[6]=g-c.y*d;l[1]=f-c.z*d;l[4]=c.y*c.y*e+b;l[7]=h+c.x*d;l[2]=g+c.y*d;l[5]=h-c.x*d;l[8]=c.z*c.z*e+b;return a.clone().applyM3(this)}});var t=Math.PI,q=Math.PI/180,F=180/Math.PI,G=new m(1,0,0),H=new m(0,1,0),I=new m(0,0,1),J=new m(-1,0,0),K=new m(0,-1,0),L=new m(0,0,-1),E=new n(0,1),M=new n(0,-1),N=new n(-1,0),O=new n(1,0);Object.assign(v.prototype,{isJoint3D:!0,clone:function(){var a=
new v;a.type=this.type;a.rotor=this.rotor;a.max=this.max;a.min=this.min;a.rotationAxisUV.copy(this.rotationAxisUV);a.referenceAxisUV.copy(this.referenceAxisUV);return a},testAngle:function(){this.freeHinge=this.max===t&&this.min===-t?!0:!1},validateAngle:function(a){a=0>a?0:a;return 180<a?180:a},setAsBallJoint:function(a){this.rotor=this.validateAngle(a)*q;this.type=10},setHinge:function(a,b,c,d,e){this.type=a;0>c&&(c*=-1);this.min=-this.validateAngle(c)*q;this.max=this.validateAngle(d)*q;this.testAngle();
this.rotationAxisUV.copy(b.normalised());this.referenceAxisUV.copy(e.normalised())},getHingeReferenceAxis:function(){return this.referenceAxisUV},getHingeRotationAxis:function(){return this.rotationAxisUV},setBallJointConstraintDegs:function(a){this.rotor=this.validateAngle(a)*q},setHingeClockwise:function(a){0>a&&(a*=-1);this.min=-this.validateAngle(a)*q;this.testAngle()},setHingeAnticlockwise:function(a){this.max=this.validateAngle(a)*q;this.testAngle()},setHingeRotationAxis:function(a){this.rotationAxisUV.copy(a).normalize()},
setHingeReferenceAxis:function(a){this.referenceAxisUV.copy(a).normalize()}});Object.assign(u.prototype,{isBone3D:!0,init:function(a,b,c,d){this.setStartLocation(a);b?(this.setEndLocation(b),this.length=this.getLength()):(this.setLength(d),this.setEndLocation(this.start.plus(c.normalised().times(d))))},clone:function(){var a=new u(this.start,this.end);a.joint=this.joint.clone();return a},setColor:function(a){this.color=a},setBoneConnectionPoint:function(a){this.boneConnectionPoint=a},setHingeClockwise:function(a){this.joint.setHingeClockwise(a)},
setHingeAnticlockwise:function(a){this.joint.setHingeAnticlockwise(a)},setBallJointConstraintDegs:function(a){this.joint.setBallJointConstraintDegs(a)},setStartLocation:function(a){this.start.copy(a)},setEndLocation:function(a){this.end.copy(a)},setLength:function(a){0<a&&(this.length=a)},setJoint:function(a){this.joint=a},getBoneConnectionPoint:function(){return this.boneConnectionPoint},getDirectionUV:function(){return this.end.minus(this.start).normalize()},getStartLocation:function(){return this.start},
getEndLocation:function(){return this.end},getLength:function(){return this.start.distanceTo(this.end)}});Object.assign(z.prototype,{isChain3D:!0,clone:function(){var a=new z;a.solveDistanceThreshold=this.solveDistanceThreshold;a.minIterationChange=this.minIterationChange;a.maxIteration=this.maxIteration;a.precision=this.precision;a.bones=this.cloneBones();a.baseLocation.copy(this.baseLocation);a.lastTargetLocation.copy(this.lastTargetLocation);a.lastBaseLocation.copy(this.lastBaseLocation);1!==this.baseboneConstraintType&&
(a.baseboneConstraintUV.copy(this.baseboneConstraintUV),a.baseboneRelativeConstraintUV.copy(this.baseboneRelativeConstraintUV));a.fixedBaseMode=this.fixedBaseMode;a.chainLength=this.chainLength;a.numBones=this.numBones;a.currentSolveDistance=this.currentSolveDistance;a.boneConnectionPoint=this.boneConnectionPoint;a.connectedChainNumber=this.connectedChainNumber;a.connectedBoneNumber=this.connectedBoneNumber;a.baseboneConstraintType=this.baseboneConstraintType;a.color=this.color;a.embeddedTarget=this.embeddedTarget.clone();
a.useEmbeddedTarget=this.useEmbeddedTarget;return a},clear:function(){for(var a=this.numBones;a--;)this.removeBone(a);this.numBones=0},addBone:function(a){a.setColor(this.color);this.bones.push(a);this.numBones++;1===this.numBones&&(this.baseLocation.copy(a.getStartLocation()),this.baseboneConstraintUV.copy(a.getDirectionUV()));this.updateChainLength()},removeBone:function(a){a<this.numBones&&(this.bones.splice(a,1),this.numBones--,this.updateChainLength())},addConsecutiveBone:function(a,b){0<this.numBones&&
this.addBone(new u(this.bones[this.numBones-1].getEndLocation(),void 0,a.normalised(),b))},addConsecutiveFreelyRotatingHingedBone:function(a,b,c,d){this.addConsecutiveHingedBone(a,b,c,d,180,180,p.genPerpendicularVectorQuick(d))},addConsecutiveHingedBone:function(a,b,c,d,e,f,g){0!==this.numBones&&(a=a.normalised(),d=d.normalised(),b=new u(this.bones[this.numBones-1].getEndLocation(),void 0,a,b,this.color),b.joint.setHinge("global"===(c||"global")?12:11,d,e,f,g),this.addBone(b))},addConsecutiveRotorConstrainedBone:function(a,
b,c){0!==this.numBones&&(a=a.normalised(),a=new u(this.bones[this.numBones-1].getEndLocation(),void 0,a,b),a.joint.setAsBallJoint(c),this.addBone(a))},getBoneConnectionPoint:function(){return this.boneConnectionPoint},getBaseboneConstraintType:function(){return this.baseboneConstraintType},getBaseboneConstraintUV:function(){if(1!==this.baseboneConstraintType)return this.baseboneConstraintUV},getBaseLocation:function(){return this.bones[0].getStartLocation()},getBone:function(a){return this.bones[a]},
getChain:function(){return this.bones},getChainLength:function(){return this.chainLength},getConnectedBoneNumber:function(){return this.connectedBoneNumber},getConnectedChainNumber:function(){return this.connectedChainNumber},getEffectorLocation:function(){return this.bones[this.numBones-1].getEndLocation()},getLastTargetLocation:function(){return this.lastTargetLocation},getLiveChainLength:function(){for(var a=0,b=0;b<this.numBones;b++)a+=this.bones[b].getLength();return a},getName:function(){return this.name},
getNumBones:function(){return this.numBones},getBaseboneRelativeReferenceConstraintUV:function(){return this.baseboneRelativeReferenceConstraintUV},setConnectedBoneNumber:function(a){this.connectedBoneNumber=a},setConnectedChainNumber:function(a){this.connectedChainNumber=a},setBoneConnectionPoint:function(a){this.boneConnectionPoint=a},setColor:function(a){this.color=a;for(var b=0;b<this.numBones;b++)this.bones[b].setColor(a)},setBaseboneRelativeConstraintUV:function(a){this.baseboneRelativeConstraintUV=
a},setBaseboneRelativeReferenceConstraintUV:function(a){this.baseboneRelativeReferenceConstraintUV=a},setRotorBaseboneConstraint:function(a,b,c){0===this.numBones?r.error("Chain must contain a basebone before we can specify the basebone constraint type."):0<b.length()?(this.baseboneConstraintType="global"===(a||"global")?2:4,this.baseboneConstraintUV=b.normalised(),this.baseboneRelativeConstraintUV.copy(this.baseboneConstraintUV),this.getBone(0).joint.setAsBallJoint(c)):r.error("Constraint axis cannot be zero.")},
setHingeBaseboneConstraint:function(a,b,c,d,e){0===this.numBones?r.error("Chain must contain a basebone before we can specify the basebone constraint type."):0>=b.length()?r.error("Hinge rotation axis cannot be zero."):0>=e.length()?r.error("Hinge reference axis cannot be zero."):p.perpendicular(b,e)?(a=a||"global",this.baseboneConstraintType="global"===a?3:5,this.baseboneConstraintUV.copy(b.normalised()),this.getBone(0).joint.setHinge("global"===a?12:11,b,c,d,e)):r.error("The hinge reference axis must be in the plane of the hinge rotation axis, that is, they must be perpendicular.")},
setFreelyRotatingGlobalHingedBasebone:function(a){this.setHingeBaseboneConstraint("global",a,180,180,p.genPerpendicularVectorQuick(a))},setGlobalHingedBasebone:function(a,b,c,d){this.setHingeBaseboneConstraint("global",a,b,c,d)},setFreelyRotatingLocalHingedBasebone:function(a){this.setHingeBaseboneConstraint("local",a,180,180,p.genPerpendicularVectorQuick(a))},setLocalHingedBasebone:function(a,b,c,d){this.setHingeBaseboneConstraint("local",a,b,c,d)},setBaseboneConstraintUV:function(a){1!==this.baseboneConstraintType&&
(this.constraintUV.normalize(),this.baseboneConstraintUV.copy(a))},setBaseLocation:function(a){this.baseLocation.copy(a)},setChain:function(a){this.bones=[];for(var b=a.length,c=0;c<b;c++)this.bones[c]=a[c]},setFixedBaseMode:function(a){if(a||-1===this.connectedChainNumber)if(2!==this.baseboneConstraintType||a)this.fixedBaseMode=a},setMaxIterationAttempts:function(a){1>a||(this.maxIteration=a)},setMinIterationChange:function(a){0>a||(this.minIterationChange=a)},setSolveDistanceThreshold:function(a){0>
a||(this.solveDistanceThreshold=a)},solveForEmbeddedTarget:function(){if(this.useEmbeddedTarget)return this.solveForTarget(this.embeddedTarget)},resetTarget:function(){this.lastBaseLocation=new m(Infinity,Infinity,Infinity);this.currentSolveDistance=Infinity},solveForTarget:function(a){this.tmpTarget.set(a.x,a.y,a.z);var b=this.precision;if(this.lastTargetLocation.approximatelyEquals(this.tmpTarget,b)&&this.lastBaseLocation.approximatelyEquals(this.baseLocation,b))return this.currentSolveDistance;
a=null;this.lastBaseLocation.approximatelyEquals(this.baseLocation,b)?(b=p.distanceBetween(this.bones[this.numBones-1].getEndLocation(),this.tmpTarget),a=this.cloneBones()):b=Infinity;for(var c=[],d=Infinity,e=Infinity,f,g=this.maxIteration;g--;){f=this.solveIK(this.tmpTarget);if(f<d){if(d=f,c=this.cloneBones(),f<=this.solveDistanceThreshold)break}else if(Math.abs(f-e)<this.minIterationChange)break;e=f}d<b?(this.currentSolveDistance=d,this.bones=c):(this.currentSolveDistance=b,this.bones=a);this.lastBaseLocation.copy(this.baseLocation);
this.lastTargetLocation.copy(this.tmpTarget);return this.currentSolveDistance},solveIK:function(a){if(0!==this.numBones){for(var b,c,d,e,f=this.tmpMtx,g=this.numBones;g--;){b=this.bones[g];c=b.length;d=b.joint;e=d.type;if(g!==this.numBones-1){var h=this.bones[g+1].getDirectionUV().negate(),l=b.getDirectionUV().negate();if(10===e)l.limitAngle(h,f,d.rotor);else if(12===e)l.projectOnPlane(d.getHingeRotationAxis()),this.isFullForward&&(d.freeHinge||l.constrainedUV(d.getHingeReferenceAxis(),d.getHingeRotationAxis(),
f,d.min,d.max));else if(11===e){if(0<g){if(f.createRotationMatrix(this.bones[g-1].getDirectionUV()),e=d.getHingeRotationAxis().clone().applyM3(f),this.isFullForward){f.createRotationMatrix(this.bones[g-1].getDirectionUV().negate());e=d.getHingeRotationAxis().clone().applyM3(f);var k=d.getHingeReferenceAxis().clone().applyM3(f)}}else this.isFullForward&&(k=this.baseboneRelativeReferenceConstraintUV),e=this.baseboneRelativeConstraintUV.clone();l.projectOnPlane(e);this.isFullForward&&(d.freeHinge||l.constrainedUV(k,
e,f,d.min,d.max))}c=b.getEndLocation().plus(l.times(c))}else{b.setEndLocation(a);l=b.getDirectionUV().negated();switch(e){case 12:l.projectOnPlane(d.getHingeRotationAxis());break;case 11:f.createRotationMatrix(this.bones[g-1].getDirectionUV()),e=d.getHingeRotationAxis().clone().applyM3(f),l.projectOnPlane(e)}c=a.plus(l.times(c))}b.setStartLocation(c);0<g&&this.bones[g-1].setEndLocation(c)}for(g=0;g<this.numBones;g++)if(b=this.bones[g],c=b.length,d=b.joint,e=d.type,0!==g){k=b.getDirectionUV();l=this.bones[g-
1].getDirectionUV();switch(e){case 10:k.limitAngle(l,f,d.rotor);break;case 12:e=d.getHingeRotationAxis();l=d.getHingeReferenceAxis();k.projectOnPlane(e);d.freeHinge||k.constrainedUV(l,e,f,d.min,d.max);break;case 11:f.createRotationMatrix(l),e=d.getHingeRotationAxis().clone().applyM3(f),l=d.getHingeReferenceAxis().clone().applyM3(f),k.projectOnPlane(e),d.freeHinge||k.constrainedUV(l,e,f,d.min,d.max)}c=b.getStartLocation().plus(k.times(c));b.setEndLocation(c);g<this.numBones-1&&this.bones[g+1].setStartLocation(c)}else{this.fixedBaseMode?
b.setStartLocation(this.baseLocation):b.setStartLocation(b.getEndLocation().minus(b.getDirectionUV().times(c)));k=b.getDirectionUV();switch(this.baseboneConstraintType){case 2:k.limitAngle(this.baseboneConstraintUV,f,d.rotor);break;case 4:k.limitAngle(this.baseboneRelativeConstraintUV,f,d.rotor);break;case 3:e=d.getHingeRotationAxis();l=d.getHingeReferenceAxis();k.projectOnPlane(e);d.freeHinge||k.constrainedUV(l,e,f,d.min,d.max);break;case 5:e=this.baseboneRelativeConstraintUV,l=this.baseboneRelativeReferenceConstraintUV,
k.projectOnPlane(e),d.freeHinge||k.constrainedUV(l,e,f,d.min,d.max)}c=b.getStartLocation().plus(k.times(c));b.setEndLocation(c);1<this.numBones&&this.bones[1].setStartLocation(c)}this.lastTargetLocation.copy(a);return this.bones[this.numBones-1].getEndLocation().distanceTo(a)}},updateChainLength:function(){this.chainLength=0;for(var a=this.numBones;a--;)this.chainLength+=this.bones[a].length},cloneBones:function(){for(var a=[],b=0,c=this.bones.length;b<c;b++)a.push(this.bones[b].clone());return a}});
Object.assign(B.prototype,{update:function(){for(var a,b,c,d,e=0;e<this.numChains;e++){a=this.chains[e];b=this.targets[e];c=a.getConnectedChainNumber();if(-1!==c)switch(d=this.chains[c].getBone(a.getConnectedBoneNumber()),a.setBaseLocation(20===a.getBoneConnectionPoint()?d.getStartLocation():d.getEndLocation()),c=a.getBaseboneConstraintType(),c){case 4:case 5:this.tmpMtx.createRotationMatrix(d.getDirectionUV()),d=a.getBaseboneConstraintUV().clone().applyM3(this.tmpMtx),a.setBaseboneRelativeConstraintUV(d),
5===c&&a.setBaseboneRelativeReferenceConstraintUV(a.bones[0].joint.getHingeReferenceAxis().clone().applyM3(this.tmpMtx))}a.useEmbeddedTarget?a.solveForEmbeddedTarget():a.solveForTarget(b);if(this.isWithMesh)for(b=this.meshChains[e],d=0;d<a.numBones;d++)c=a.bones[d],b[d].position.copy(c.getStartLocation()),b[d].lookAt(c.getEndLocation())}},clear:function(){this.clearAllBoneMesh();var a;for(a=this.numChains;a--;)this.remove(a);this.chains=[];this.meshChains=[];this.targets=[]},add:function(a,b,c){this.chains.push(a);
this.targets.push(b);this.numChains++;c&&this.addChainMeshs(a)},remove:function(a){this.chains[a].clear();this.chains.splice(a,1);this.meshChains.splice(a,1);this.targets.splice(a,1);this.numChains--},setFixedBaseMode:function(a){this.fixedBaseMode=a;a=this.numChains;for(var b;a--;)b=this.chains[a].getConnectedChainNumber(),-1===b&&this.chains[a].setFixedBaseMode(this.fixedBaseMode)},getNumChains:function(){return this.numChains},getChain:function(a){return this.chains[a]},connectChain:function(a,
b,c,d,e,f,g){if(!(b>this.numChains||c>this.chains[b].numBones)){a=a.clone();void 0!==g&&a.setColor(g);a.setBoneConnectionPoint("end"===d?21:20);a.setConnectedChainNumber(b);a.setConnectedBoneNumber(c);b="end"===d?this.chains[b].bones[c].end:this.chains[b].bones[c].start;a.setBaseLocation(b);a.setFixedBaseMode(!0);for(c=0;c<a.numBones;c++)a.bones[c].start.add(b),a.bones[c].end.add(b);this.add(a,e,f)}},addChainMeshs:function(a,b){this.isWithMesh=!0;b=[];for(var c=a.bones.length,d=0;d<c;d++)b.push(this.addBoneMesh(a.bones[d],
d-1,b,a));this.meshChains.push(b)},addBoneMesh:function(a,b,c,d){var e=a.length,f=a.color,g=new THREE.CylinderBufferGeometry(1,.5,e,4);g.applyMatrix((new THREE.Matrix4).makeRotationX(.5*-Math.PI));g.applyMatrix((new THREE.Matrix4).makeTranslation(0,0,.5*e));var h=new THREE.MeshStandardMaterial({color:f,wireframe:!1,shadowSide:!1}),l=new THREE.MeshBasicMaterial({wireframe:!0}),k=null;e=a.joint.type;switch(e){case 10:l.color.setHex(16737792);if(a.joint.rotor===Math.PI)break;a=new THREE.CylinderBufferGeometry(0,
2,2,6,1,!0);a.applyMatrix((new THREE.Matrix4).makeRotationX(.5*-Math.PI));a.applyMatrix((new THREE.Matrix4).makeTranslation(0,0,1));k=new THREE.Mesh(a,l);break;case 12:f=a.joint.getHingeRotationAxis();var m=a.joint.min;a=a.joint.max;k=2;l.color.setHex(16776960);a=new THREE.CircleBufferGeometry(k,12,m,-m+a);1===f.z&&a.applyMatrix((new THREE.Matrix4).makeRotationX(.5*-Math.PI));1===f.y&&(a.applyMatrix((new THREE.Matrix4).makeRotationY(.5*-Math.PI)),a.applyMatrix((new THREE.Matrix4).makeRotationX(.5*
-Math.PI)));1===f.x&&a.applyMatrix((new THREE.Matrix4).makeRotationY(.5*Math.PI));k=new THREE.Mesh(a,l);break;case 11:f=a.joint.getHingeRotationAxis(),k=2,m=a.joint.min,a=a.joint.max,l.color.setHex(65535),a=new THREE.CircleBufferGeometry(k,12,m,-m+a),a.applyMatrix((new THREE.Matrix4).makeRotationX(.5*-Math.PI)),1===f.z&&(a.applyMatrix((new THREE.Matrix4).makeRotationY(.5*-Math.PI)),a.applyMatrix((new THREE.Matrix4).makeRotationX(.5*Math.PI))),1===f.x&&a.applyMatrix((new THREE.Matrix4).makeRotationZ(.5*
-Math.PI)),1===f.y&&(a.applyMatrix((new THREE.Matrix4).makeRotationX(.5*Math.PI)),a.applyMatrix((new THREE.Matrix4).makeRotationY(.5*Math.PI))),k=new THREE.Mesh(a,l)}f=new THREE.AxesHelper(1.5);g=new THREE.Mesh(g,h);g.add(f);this.scene.add(g);g.castShadow=!0;g.receiveShadow=!0;-1!==b?null!==k&&(12!==e?(k.position.z=d.bones[b].length,c[b].add(k)):g.add(k)):null!==k&&g.add(k);return g},clearAllBoneMesh:function(){if(this.isWithMesh){var a,b;for(a=this.meshChains.length;a--;){for(b=this.meshChains[a].length;b--;){var c=
this.meshChains[a][b];this.scene.remove(c);c.geometry.dispose();c.material.dispose()}this.meshChains[a]=[]}this.meshChains=[]}}});Object.assign(w.prototype,{isJoint2D:!0,clone:function(){var a=new w;a.coordinateSystem=this.coordinateSystem;a.max=this.max;a.min=this.min;return a},validateAngle:function(a){a=0>a?0:a;return 180<a?180:a},set:function(a){this.max=a.max;this.min=a.min;this.coordinateSystem=a.coordinateSystem},setClockwiseConstraintDegs:function(a){this.min=-(this.validateAngle(a)*q)},setAnticlockwiseConstraintDegs:function(a){this.max=
this.validateAngle(a)*q},setConstraintCoordinateSystem:function(a){this.coordinateSystem=a},getConstraintCoordinateSystem:function(){return this.coordinateSystem}});Object.assign(x.prototype,{isBone2D:!0,clone:function(){var a=new x(this.start,this.end);a.length=this.length;a.globalConstraintUV=this.globalConstraintUV;a.boneConnectionPoint=this.boneConnectionPoint;a.joint=this.joint.clone();a.color=this.color;a.name=this.name;return a},setName:function(a){this.name=a},setColor:function(a){this.color=
a},setBoneConnectionPoint:function(a){this.boneConnectionPoint=a},setStartLocation:function(a){this.start.copy(a)},setEndLocation:function(a){this.end.copy(a)},setLength:function(a){0<a&&(this.length=a)},setGlobalConstraintUV:function(a){this.globalConstraintUV=a},setJoint:function(a){this.joint=a},setClockwiseConstraintDegs:function(a){this.joint.setClockwiseConstraintDegs(a)},setAnticlockwiseConstraintDegs:function(a){this.joint.setAnticlockwiseConstraintDegs(a)},setJointConstraintCoordinateSystem:function(a){this.joint.setConstraintCoordinateSystem(a)},
getGlobalConstraintUV:function(){return this.globalConstraintUV},getBoneConnectionPoint:function(){return this.boneConnectionPoint},getDirectionUV:function(){return this.end.minus(this.start).normalize()},getLength:function(){return this.start.distanceTo(this.end)},getStartLocation:function(){return this.start},getEndLocation:function(){return this.end}});Object.assign(A.prototype,{isChain2D:!0,clone:function(){var a=new A;a.solveDistanceThreshold=this.solveDistanceThreshold;a.minIterationChange=
this.minIterationChange;a.maxIteration=this.maxIteration;a.precision=this.precision;a.bones=this.cloneBones();a.baseLocation.copy(this.baseLocation);a.lastTargetLocation.copy(this.lastTargetLocation);a.lastBaseLocation.copy(this.lastBaseLocation);1!==this.baseboneConstraintType&&(a.baseboneConstraintUV.copy(this.baseboneConstraintUV),a.baseboneRelativeConstraintUV.copy(this.baseboneRelativeConstraintUV));a.fixedBaseMode=this.fixedBaseMode;a.chainLength=this.chainLength;a.numBones=this.numBones;a.currentSolveDistance=
this.currentSolveDistance;a.boneConnectionPoint=this.boneConnectionPoint;a.connectedChainNumber=this.connectedChainNumber;a.connectedBoneNumber=this.connectedBoneNumber;a.baseboneConstraintType=this.baseboneConstraintType;a.color=this.color;a.embeddedTarget=this.embeddedTarget.clone();a.useEmbeddedTarget=this.useEmbeddedTarget;return a},clear:function(){for(var a=this.numBones;a--;)this.removeBone(a)},addBone:function(a){null===a.color&&a.setColor(this.color);this.bones.push(a);0===this.numBones&&
(this.baseLocation.copy(a.getStartLocation()),this.baseboneConstraintUV.copy(a.getDirectionUV()));this.numBones++;this.updateChainLength()},removeBone:function(a){a<this.numBones&&(this.bones.splice(a,1),this.numBones--,this.updateChainLength())},addConsecutiveBone:function(a,b,c,d,e){if(0===this.numBones)r.error("Chain is empty ! need first bone");else if(a.isBone2D){b=a.getDirectionUV();p.validateDirectionUV(b);c=a.length;p.validateLength(c);var f=this.bones[this.numBones-1].getEndLocation();a.setStartLocation(f);
a.setEndLocation(f.plus(b.times(c)));this.addBone(a)}else a.isVector2&&(e=e||this.color,p.validateDirectionUV(a),p.validateLength(b),f=this.bones[this.numBones-1].getEndLocation(),this.addBone(new x(f,null,a.normalised(),b,c,d,e)))},getBoneConnectionPoint:function(){return this.boneConnectionPoint},getEmbeddedTarget:function(){return this.embeddedTarget},getEmbeddedTargetMode:function(){return this.useEmbeddedTarget},getBaseboneConstraintType:function(){return this.baseboneConstraintType},getBaseboneConstraintUV:function(){if(1!==
this.baseboneConstraintType)return this.baseboneConstraintUV},getBaseLocation:function(){return this.bones[0].getStartLocation()},getBone:function(a){return this.bones[a]},getChain:function(){return this.bones},getChainLength:function(){return this.chainLength},getConnectedBoneNumber:function(){return this.connectedBoneNumber},getConnectedChainNumber:function(){return this.connectedChainNumber},getEffectorLocation:function(){return this.bones[this.numBones-1].getEndLocation()},getLastTargetLocation:function(){return this.lastTargetLocation},
getLiveChainLength:function(){for(var a=0,b=this.numBones;b--;)a+=this.bones[b].getLength();return a},getNumBones:function(){return this.numBones},setColor:function(a){this.color=a;for(a=this.numBones;a--;)this.bones[a].setColor(this.color)},setBaseboneRelativeConstraintUV:function(a){this.baseboneRelativeConstraintUV=a},setConnectedBoneNumber:function(a){this.connectedBoneNumber=a},setConnectedChainNumber:function(a){this.connectedChainNumber=a},setBoneConnectionPoint:function(a){this.boneConnectionPoint=
a},setBaseboneConstraintUV:function(a){p.validateDirectionUV(a);this.baseboneConstraintUV.copy(a.normalised())},setBaseLocation:function(a){this.baseLocation.copy(a)},setBaseboneConstraintType:function(a){this.baseboneConstraintType=a},setFixedBaseMode:function(a){if(a||-1===this.connectedChainNumber)if(6!==this.baseboneConstraintType||a)this.fixedBaseMode=a},setMaxIterationAttempts:function(a){1>a||(this.maxIteration=a)},setMinIterationChange:function(a){0>a||(this.minIterationChange=a)},setSolveDistanceThreshold:function(a){0>
a||(this.solveDistanceThreshold=a)},solveForEmbeddedTarget:function(){if(this.useEmbeddedTarget)return this.solveForTarget(this.embeddedTarget)},resetTarget:function(){this.lastBaseLocation=new n(Infinity,Infinity);this.currentSolveDistance=Infinity},solveForTarget:function(a){this.tmpTarget.set(a.x,a.y);var b=this.precision;if(this.lastTargetLocation.approximatelyEquals(this.tmpTarget,b)&&this.lastBaseLocation.approximatelyEquals(this.baseLocation,b))return this.currentSolveDistance;a=null;this.lastBaseLocation.approximatelyEquals(this.baseLocation,
b)?(b=p.distanceBetween(this.bones[this.numBones-1].getEndLocation(),this.tmpTarget),a=this.cloneBones()):b=Infinity;for(var c=[],d=Infinity,e=Infinity,f,g=this.maxIteration;g--;){f=this.solveIK(this.tmpTarget);if(f<d){if(d=f,c=this.cloneBones(),f<=this.solveDistanceThreshold)break}else if(Math.abs(f-e)<this.minIterationChange)break;e=f}d<b?(this.currentSolveDistance=d,this.bones=c):(this.currentSolveDistance=b,this.bones=a);this.lastBaseLocation.copy(this.baseLocation);this.lastTargetLocation.copy(this.tmpTarget);
return this.currentSolveDistance},solveIK:function(a){if(0!==this.numBones){for(var b,c,d,e,f,g=this.numBones;g--;)b=this.bones[g],c=b.length,g!==this.numBones-1?(d=this.bones[g+1],e=b.getDirectionUV().negate(),f=11===b.joint.coordinateSystem?d.getDirectionUV().negate():b.getGlobalConstraintUV().negated(),e.constrainedUV(f,d.joint.min,d.joint.max)):(b.setEndLocation(a),e=b.getDirectionUV().negate(),0<g?(f=11===b.joint.coordinateSystem?this.bones[g-1].getDirectionUV().negate():b.getGlobalConstraintUV().negated(),
e.constrainedUV(f,b.joint.min,b.joint.max)):11!==b.joint.coordinateSystem&&(f=b.getGlobalConstraintUV().negated(),e.constrainedUV(f,b.joint.min,b.joint.max))),d=b.getEndLocation().plus(e.times(c)),b.setStartLocation(d),0<g&&this.bones[g-1].setEndLocation(d);for(g=0;g<this.numBones;g++)b=this.bones[g],c=b.length,0!==g?(e=b.getDirectionUV(),f=11===b.joint.coordinateSystem?this.bones[g-1].getDirectionUV():b.getGlobalConstraintUV(),e.constrainedUV(f,b.joint.min,b.joint.max),c=b.getStartLocation().plus(e.times(c)),
b.setEndLocation(c),g<this.numBones-1&&this.bones[g+1].setStartLocation(c)):(this.fixedBaseMode?b.setStartLocation(this.baseLocation):(d=b.getEndLocation().minus(b.getDirectionUV().times(c)),b.setStartLocation(d)),e=b.getDirectionUV(),1===this.baseboneConstraintType?(c=b.getStartLocation().plus(e.times(c)),b.setEndLocation(c),1<this.numBones&&this.bones[1].setStartLocation(c)):(f=8===this.baseboneConstraintType?this.baseboneRelativeConstraintUV:this.baseboneConstraintUV,e.constrainedUV(f,b.joint.min,
b.joint.max),c=b.getStartLocation().plus(e.times(c)),b.setEndLocation(c),g<this.numBones-1&&this.bones[g+1].setStartLocation(c)));this.lastTargetLocation.copy(a);b=this.bones[this.numBones-1].getEndLocation();return p.distanceBetween(b,a)}},updateChainLength:function(){this.chainLength=0;for(var a=this.numBones;a--;)this.chainLength+=this.bones[a].length},cloneBones:function(){for(var a=[],b=0,c=this.bones.length;b<c;b++)a.push(this.bones[b].clone());return a}});Object.assign(C.prototype,{isStructure2D:!0,
update:function(){for(var a,b,c,d=new THREE.Vector3,e,f=0;f<this.numChains;f++)if(a=this.chains[f],b=this.targets[f],e=a.getConnectedChainNumber(),c=a.getBaseboneConstraintType(),-1!==e&&6!==c&&(e=this.chains[e].getBone(a.getConnectedBoneNumber()),a.setBaseLocation(20===a.getBoneConnectionPoint()?e.getStartLocation():e.getEndLocation()),e=e.getDirectionUV(),7===c?a.setBaseboneConstraintUV(e):8===c&&(c=E.getSignedAngle(e),c=a.getBaseboneConstraintUV().rotate(c),a.setBaseboneRelativeConstraintUV(c))),
a.useEmbeddedTarget?a.solveForEmbeddedTarget():a.solveForTarget(b),this.isWithMesh)for(b=this.meshChains[f],e=0;e<a.numBones;e++)c=a.getBone(e),b[e].position.set(c.start.x,c.start.y,0),b[e].lookAt(d.set(c.end.x,c.end.y,0))},setFixedBaseMode:function(a){this.fixedBaseMode=a;a=this.numChains;for(var b;a--;)b=this.chains[a].getConnectedChainNumber(),-1===b&&this.chains[a].setFixedBaseMode(this.fixedBaseMode)},clear:function(){this.clearAllBoneMesh();var a;for(a=this.numChains;a--;)this.remove(a);this.chains=
[];this.meshChains=[];this.targets=[]},add:function(a,b,c){this.chains.push(a);this.targets.push(b);this.numChains++;c&&this.addChainMeshs(a)},remove:function(a){this.chains[a].clear();this.chains.splice(a,1);this.meshChains.splice(a,1);this.targets.splice(a,1);this.numChains--},getNumChains:function(){return this.numChains},getChain:function(a){return this.chains[a]},connectChain:function(a,b,c,d,e,f,g){d=d||"end";if(b>this.numChains)r.error("Chain not existe !");else if(c>this.chains[b].numBones)r.error("Bone not existe !");
else{a=a.clone();a.setBoneConnectionPoint("end"===d?21:20);a.setConnectedChainNumber(b);a.setConnectedBoneNumber(c);b="end"===d?this.chains[b].bones[c].end:this.chains[b].bones[c].start;a.setBaseLocation(b);a.setFixedBaseMode(!0);for(c=0;c<a.numBones;c++)a.bones[c].start.add(b),a.bones[c].end.add(b);this.add(a,e,f)}},addChainMeshs:function(a,b){this.isWithMesh=!0;b=[];for(var c=a.bones.length,d=0;d<c;d++)b.push(this.addBoneMesh(a.bones[d]));this.meshChains.push(b)},addBoneMesh:function(a){var b=a.length,
c=a.color;a=new THREE.CylinderBufferGeometry(1,.5,b,4);a.applyMatrix((new THREE.Matrix4).makeRotationX(-p.pi90));a.applyMatrix((new THREE.Matrix4).makeTranslation(0,0,.5*b));b=new THREE.MeshStandardMaterial({color:c,wireframe:!1,shadowSide:!1});new THREE.MeshBasicMaterial({wireframe:!0});b=new THREE.Mesh(a,b);b.castShadow=!0;b.receiveShadow=!0;this.scene.add(b);return b},clearAllBoneMesh:function(){if(this.isWithMesh){var a,b;for(a=this.meshChains.length;a--;){for(b=this.meshChains[a].length;b--;){var c=
this.meshChains[a][b];this.scene.remove(c);c.geometry.dispose();c.material.dispose()}this.meshChains[a]=[]}this.meshChains=[]}}});Object.assign(D.prototype,{isIKSolver:!0});h._Math=p;h.V2=n;h.V3=m;h.M3=y;h.Joint3D=v;h.Bone3D=u;h.Chain3D=z;h.Structure3D=B;h.Joint2D=w;h.Bone2D=x;h.Chain2D=A;h.Structure2D=C;h.IKSolver=D;h.REVISION="1.3.3";h.MIN_DEGS=0;h.MAX_DEGS=180;h.MAX_RAD=t;h.PRECISION=.001;h.PRECISION_DEG=.01;h.MAX_VALUE=Infinity;h.TORAD=q;h.TODEG=F;h.NONE=1;h.GLOBAL_ROTOR=2;h.GLOBAL_HINGE=3;h.LOCAL_ROTOR=
4;h.LOCAL_HINGE=5;h.GLOBAL_ABSOLUTE=6;h.LOCAL_RELATIVE=7;h.LOCAL_ABSOLUTE=8;h.J_BALL=10;h.J_LOCAL=11;h.J_GLOBAL=12;h.START=20;h.END=21;h.X_AXE=G;h.Y_AXE=H;h.Z_AXE=I;h.X_NEG=J;h.Y_NEG=K;h.Z_NEG=L;h.UP=E;h.DOWN=M;h.LEFT=N;h.RIGHT=O;Object.defineProperty(h,"__esModule",{value:!0})});
